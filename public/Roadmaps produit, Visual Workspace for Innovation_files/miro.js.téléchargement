"use strict";var miro=(()=>{var Y=Object.defineProperty;var lt=Object.getOwnPropertyDescriptor;var yt=Object.getOwnPropertyNames;var ut=Object.prototype.hasOwnProperty;var o=(r,e)=>Y(r,"name",{value:e,configurable:!0});var gt=(r,e)=>{for(var t in e)Y(r,t,{get:e[t],enumerable:!0})},ht=(r,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of yt(e))!ut.call(r,i)&&i!==t&&Y(r,i,{get:()=>e[i],enumerable:!(s=lt(e,i))||s.enumerable});return r};var ft=r=>ht(Y({},"__esModule",{value:!0}),r);var Vt={};gt(Vt,{board:()=>Ut,clientVersion:()=>ct});function $(){return Math.random().toString(36).slice(-10)}o($,"generateId");function Tt(r){return r instanceof ArrayBuffer}o(Tt,"isTransferableObject");async function de(r){if(!r)return[];if(r instanceof Blob)return[await r.arrayBuffer()];if(Tt(r))return[r];if(typeof r!="object")return[];let e=Object.values(r).map(s=>typeof s=="object"&&s!==null?de(s):Promise.resolve([]));return(await Promise.all(e)).flat()}o(de,"getTransferable");var tt="sdkv2-plugin-message";function Et(r){return r!==null&&"window"in r}o(Et,"isWindow");function wt(r){return!(r.data?.commandId!==tt||!Array.isArray(r.data?.payload))}o(wt,"isSdkMessage");var ce=class ce{constructor(e,t,s,i){this.hostWindow=e;this.clientOrigin=t;this.messageHandler=s;this.windowGetter=i;this.waiting=new Map;this.handlePostMessage=o(e=>{if(this.clientOrigin!=="*"&&e.origin!==this.clientOrigin||!wt(e)||!Et(e.source)||e.source!==this.windowGetter())return;let{msgId:t,payload:s}=e.data,i=this.waiting.get(t);if(i)this.waiting.delete(t),i.resolve(s);else{let a=o(m=>{m&&this.dispatch(m,t)},"after");this.messageHandler(s).then(a).catch(a)}},"handlePostMessage")}init(){this.hostWindow.addEventListener("message",this.handlePostMessage)}destroy(){this.waiting.clear(),this.hostWindow.removeEventListener("message",this.handlePostMessage)}dispatch(e,t){return new Promise((s,i)=>de(e).then(a=>{if(!this.windowGetter())return;let m=!t,y=m?$():t,pe={commandId:tt,payload:e,msgId:y};this.windowGetter().postMessage(pe,this.clientOrigin,a),m?this.waiting.set(y,{resolve:s,reject:i}):(this.waiting.delete(y),s(null))}).catch(i))}};o(ce,"SdkPostMessageBus");var j=ce;var le=class le{constructor(e){this.waitingResponse=new Map;this.handlers=new Map;this.responseHandler=o(e=>{let t=e;for(let s=0;s<t.length;s++){let i=t[s];if(!i)continue;let a=this.waitingResponse.get(i.id);a&&(i.status==="S"?a.resolve(i.payload):i.status==="F"&&a.reject(new Error(String(i.payload))),this.waitingResponse.delete(i.id))}return Promise.resolve([])},"responseHandler");this.handle=o(e=>{let t=e,s=[];for(let i=0;i<t.length;i++){let a=t[i];if(a?.status){this.responseHandler([a]);continue}let m=a&&this.handlers.get(a.id);m&&m.forEach(y=>{s.push(y(a))})}return Promise.all(s)},"handle");this.bus=new j(e,"*",this.handle,()=>e.parent),this.bus.init()}destroy(){this.bus.destroy()}async exec(e,t){let s=$(),a=[{name:e,payload:t,id:s}];return new Promise((m,y)=>{this.waitingResponse.set(s,{resolve:m,reject:y}),this.bus.dispatch(a).then(this.responseHandler)})}subscribe(e,t){let s=this.handlers.get(e)||[];this.handlers.set(e,[...s,t])}unsubscribe(e,t){let s=(this.handlers.get(e)||[]).filter(i=>i!==t);s.length===0?this.handlers.delete(e):this.handlers.set(e,s)}hasEventSubscriptions(e){return this.handlers.has(e)}};o(le,"IframeCommander");var G=le;var ye=class ye{constructor(e,t){this.realCommander=e;this.prefix=t}exec(e,t){let s=`${this.prefix.toUpperCase()}_${e}`;return this.realCommander.exec(s,t)}subscribe(e,t){this.realCommander.subscribe(e,t)}unsubscribe(e,t){this.realCommander.unsubscribe(e,t)}hasEventSubscriptions(e){return this.realCommander.hasEventSubscriptions(e)}};o(ye,"CommanderProxy");var B=ye;var p=o((r,e,t)=>{Object.defineProperty(r,e,{enumerable:!1,writable:!1,configurable:!1,value:t})},"setPrivateField");function ue(r){return r!=null&&typeof r=="object"&&!Array.isArray(r)&&!(r instanceof Blob)}o(ue,"isObject");function d(r,...e){if(!e.length)return r;let t=e.shift();return ue(r)&&ue(t)&&Object.keys(t).forEach(s=>{ue(t[s])?(r[s]||Object.assign(r,{[s]:{}}),d(r[s],t[s])):Object.assign(r,{[s]:t[s]})}),d(r,...e)}o(d,"mergeDeep");function rt(r){let e={};return Object.keys(r).forEach(t=>{let s=r[t];typeof s!="function"&&(e[t]=s)}),e}o(rt,"asProps");var st=o(async r=>new Promise((e,t)=>{let s=new FileReader;s.onload=()=>{e(s.result?.toString()??"")},s.onerror=()=>{t(s.error)},s.onabort=()=>{t(new Error("Aborted"))},s.readAsDataURL(r)}),"blobToDataUrl");var c=Symbol("EventManager"),n=Symbol("Commander");var f=o(async(r,e,t)=>{let s=await e.exec("WIDGET_GET",r);if(!Array.isArray(s))throw new Error("Error retrieving items");return s.map(i=>t(e,i))},"getItems");var ge=class ge{constructor(e){p(this,n,e)}async sync(){let e=await this[n].exec("WIDGET_UPDATE",this);d(this,e)}async getMetadata(e){return this[n].exec("WIDGET_GET_METADATA",{itemId:this.id,key:e})}async setMetadata(e,t){return this[n].exec("WIDGET_SET_METADATA",{itemId:this.id,key:e,value:t})}async goToLink(){return this[n].exec("WIDGET_GO_TO_LINK",{itemId:this.id})}async bringToFront(){return this[n].exec("BRING_TO_FRONT",{items:[this.id]})}async sendToBack(){return this[n].exec("SEND_TO_BACK",{items:[this.id]})}async bringInFrontOf(e){return this[n].exec("BRING_IN_FRONT_OF",{items:[this.id],targetId:e.id})}async sendBehindOf(e){return this[n].exec("SEND_BEHIND_OF",{items:[this.id],targetId:e.id})}async getLayerIndex(){return this[n].exec("GET_LAYER_INDEX",{itemId:this.id})}async getConnectors(){let{connectorIds:e}=this;return!e||e.length===0?[]:f({type:"connector",id:e},this[n],T)}};o(ge,"BaseItem");var l=ge;var he=class he extends l{constructor(t,s){super(t);this.type="text";this.content="";this.style={fillColor:"transparent",fillOpacity:1,fontFamily:"arial",fontSize:14,textAlign:"left",color:"#1a1a1a"};d(this,s)}};o(he,"Text");var v=he;var fe=class fe extends l{constructor(t,s){super(t);this.type="sticky_note";this.shape="square";this.content="";this.style={fillColor:"light_yellow",textAlign:"center",textAlignVertical:"middle"};this.tagIds=[];d(this,s)}};o(fe,"StickyNote");var x=fe;var Te=class Te extends l{constructor(t,s){super(t);this.type="shape";this.content="";this.shape="rectangle";this.style={fillColor:"transparent",fontFamily:"arial",fontSize:14,textAlign:"center",textAlignVertical:"middle",borderStyle:"normal",borderOpacity:1,borderColor:"#1a1a1a",borderWidth:2,fillOpacity:1,color:"#1a1a1a"};d(this,s)}};o(Te,"Shape");var P=Te;var Ee=class Ee extends l{constructor(t,s){super(t);this.type="shape";this.content="";this.shape="rectangle";this.style={fillColor:"transparent",fontFamily:"arial",fontSize:14,textAlign:"center",textAlignVertical:"middle",borderStyle:"normal",borderOpacity:1,borderColor:"#1a1a1a",borderWidth:2,fillOpacity:1,color:"#1a1a1a"};d(this,s)}};o(Ee,"ShapeExperimental");var b=Ee;var we=class we extends l{constructor(t,s){super(t);this.type="image";this.title="";this.alt="";d(this,s),p(this,n,t)}async getFile(t="original"){let s={id:this.id,format:t},i=await this[n].exec("IMAGE_GET_BLOB",s);return new File([i],this.title,{lastModified:+this.modifiedAt})}async getDataUrl(t){let s=await this.getFile(t);return await st(s)}};o(we,"Image");var I=we;var Ce=class Ce extends l{constructor(t,s){super(t);this.type="card";this.title="";this.description="";this.style={};this.dueDate=void 0;this.assignee=void 0;this.taskStatus="none";this.tagIds=[];this.fields=[];d(this,s)}};o(Ce,"Card");var S=Ce;var be=class be extends l{constructor(t,s){super(t);this.type="app_card";this.owned=!1;this.title="";this.description="";this.style={};this.tagIds=[];this.status="disconnected";this.fields=[];d(this,s)}};o(be,"AppCard");var _=be;var ve=class ve extends l{constructor(t,s){super(t);this.type="frame";this.title="";this.childrenIds=[];this.style={fillColor:"transparent"};d(this,s)}async add(t){this.childrenIds.push(t.id),await this.sync();let[s]=await f({id:t.id},this[n],g);return d(t,s),t}async remove(t){let s=t.id;if(!s)throw new Error("trying to remove a non-existent item from a frame");let i=this.childrenIds.findIndex(m=>m===s);if(i===-1)throw new Error(`Can't remove item ${s} from frame ${this.id}. The item is not a current child`);this.childrenIds.splice(i,1),await this.sync();let[a]=await f({id:t.id},this[n],g);d(t,a)}async getChildren(){return(await this[n].exec("FRAME_GET_CHILDREN",{id:this.id})).map(s=>g(this[n],s))}};o(ve,"Frame");var D=ve;var xe=class xe extends l{constructor(t,s){super(t);this.type="unsupported";d(this,s)}};o(xe,"Unsupported");var k=xe;var Pe=class Pe extends l{constructor(t,s){super(t);this.type="preview";d(this,s)}};o(Pe,"Preview");var O=Pe;var Ie=class Ie extends l{constructor(t,s){super(t);this.type="embed";this.previewUrl="";this.mode="inline";d(this,s)}};o(Ie,"Embed");var M=Ie;var Se=class Se{constructor(e,t){this.type="connector";this.shape="curved";this.start=void 0;this.end=void 0;this.style={};this.captions=[];p(this,n,e),d(this,t)}async sync(){let e=await this[n].exec("WIDGET_UPDATE",this);d(this,e)}async getMetadata(e){return this[n].exec("WIDGET_GET_METADATA",{itemId:this.id,key:e})}async setMetadata(e,t){return this[n].exec("WIDGET_SET_METADATA",{itemId:this.id,key:e,value:t})}};o(Se,"Connector");var R=Se;var Ct=o(r=>({type:"text",content:r.content,style:{}}),"viewTransformText"),bt=o(r=>({type:"shape",shape:r.shape,content:r.content,style:{color:r.style.color,fillOpacity:r.style.fillOpacity,borderStyle:r.style.borderStyle}}),"viewTransformShape"),vt=o(r=>r.type==="shape"?bt(r):r.type==="text"?Ct(r):{},"transformNodeView"),_e=class _e extends l{constructor(t,s){super(t);this.type="mindmap_node";d(this,s)}async sync(){return this.nodeView=vt(this.nodeView),super.sync()}async add(t){this.childrenIds.push(t.id),await this.sync();let[s]=await f({id:t.id},this[n],g);return d(t,s),t}async getChildren(){let t=this.childrenIds;return t.length===0?[]:f({id:t},this[n],g)}};o(_e,"MindmapNode");var A=_e,De=class De{constructor(e){this.type="mindmap_node";d(this,e)}};o(De,"MindmapNodeCreate");var X=De;var Oe=class Oe{constructor(e,t){this.type="tag";this.title="";this.color="red";p(this,n,e),d(this,t)}async sync(){return this[n].exec("WIDGET_UPDATE",this).then(e=>{d(this,e)})}};o(Oe,"TagEntity");var N=Oe;var Me=class Me{constructor(e,t){this.type="group";this.itemsIds=[];p(this,n,e),d(this,t)}async sync(){throw new Error("Not implemented yet.")}async getItems(){return(await this[n].exec("GROUP_GET_ITEMS",{id:this.id})).map(t=>g(this[n],t))}async ungroup(){return this[n].exec("GROUP_UNGROUP",{id:this.id})}};o(Me,"Group");var F=Me;function T(r,e){switch(e.type){case"text":return new v(r,e);case"sticky_note":return new x(r,e);case"shape":return new P(r,e);case"image":return new I(r,e);case"frame":return new D(r,e);case"preview":return new O(r,e);case"card":return new S(r,e);case"app_card":return new _(r,e);case"embed":return new M(r,e);case"connector":return new R(r,e);case"tag":return new N(r,e);case"group":return new F(r,e);case"document":case"mockup":case"curve":case"webscreen":case"usm":case"mindmap":case"kanban":case"table":case"svg":case"emoji":case"mindmap_node":default:return new k(r,e)}}o(T,"convertToSdkFormat");function g(r,e){switch(e.type){case"shape":return new b(r,e);case"mindmap_node":return new A(r,e);default:return T(r,e)}}o(g,"convertToSdkFormatExperimental");var xt="custom:",Re=o(r=>r.startsWith(xt),"isCustomEvent"),Ae=class Ae{constructor(e){this.commander=e;this.subscriptionsMap=new Map}async subscribe(e,t,s){this.addInternalHandler(e,t,s),this.commander.hasEventSubscriptions(e)||await this.commander.exec("UI_REGISTER_EVENT",{name:e}),this.commander.subscribe(e,s)}async unsubscribe(e,t){let s=this.subscriptionsMap.get(e),i=s?.get(t);!s||!i||(s.delete(t),this.commander.unsubscribe(e,i),this.commander.hasEventSubscriptions(e)||await this.commander.exec("UI_UNREGISTER_EVENT",{name:e}))}async unsubscribeAll(){this.subscriptionsMap.forEach((t,s)=>{t.forEach(i=>{this.commander.unsubscribe(s,i)})});let e=[...this.subscriptionsMap.keys()].filter(t=>!this.commander.hasEventSubscriptions(t)).map(t=>this.commander.exec("UI_UNREGISTER_EVENT",{name:t}));return this.subscriptionsMap.clear(),Promise.all(e)}addInternalHandler(e,t,s){this.subscriptionsMap.has(e)||this.subscriptionsMap.set(e,new Map),this.subscriptionsMap.get(e)?.set(t,s)}};o(Ae,"EventManager");var h=Ae;var Pt=["drag","drop","dragend","dragstart"],It={"pointer-events":"none","user-select":"none","-webkit-user-select":"none","-webkit-touch-callout":"none"},L=class L{constructor(){this.listeners=[];this.originalBodyStyle={};this.dragStartPosition={x:-1/0,y:-1/0}}setDragStartPosition(e,t){this.dragStartPosition={x:e,y:t}}shouldDispatchDrag(e,t){return Math.abs(e-this.dragStartPosition.x)>L.DRAG_THRESHOLD||Math.abs(t-this.dragStartPosition.y)>L.DRAG_THRESHOLD}resetDragging(){throw new Error("Not implemented")}addListener(e,t,s){this.listeners.push({type:e,selector:t,handler:s})}removeListener(e,t,s){this.listeners=this.listeners.filter(i=>i.type!==e||t!=null&&i.selector!==t||s!=null&&i.handler!==s)}isDraggableElement(e){return!(e instanceof HTMLElement)&&!(e instanceof SVGElement)?!1:this.listeners.some(({selector:t})=>!!e.closest(t))}disableClickEvents(){Object.entries(It).forEach(([e,t])=>{this.originalBodyStyle[e]=document.body.style.getPropertyValue(e),document.body.style.setProperty(e,t)})}restoreClickEvents(){Object.entries(this.originalBodyStyle).forEach(([e,t])=>{document.body.style.setProperty(e,t)}),this.originalBodyStyle={}}dragEnd(e){this.dispatch("dragend",{target:e,clientX:NaN,clientY:NaN,screenX:NaN,screenY:NaN})}dispatch(e,t){this.listeners.forEach(({selector:s,handler:i,type:a})=>{if(e!==a)return;let m=t.target.closest(s);if(!m)return;let y=new CustomEvent(e,{detail:{...t,target:m,type:e}});i(y)})}};o(L,"BaseDragSensor"),L.DRAG_THRESHOLD=8;var q=L,Le=class Le extends q{constructor(){super();this.isDragging=!1;this.onMouseDown=o(t=>{let s=t.target;this.isDraggableElement(s)&&(s.setAttribute("draggable","false"),this.target=s,this.setDragStartPosition(t.clientX,t.clientY),document.addEventListener("mouseup",this.onMouseUp),document.addEventListener("mousemove",this.onMouseMove,{passive:!0}))},"onMouseDown");this.onMouseMove=o(t=>{if(!this.target)return;let{clientX:s,clientY:i,screenX:a,screenY:m}=t;if(!this.isDragging&&!this.shouldDispatchDrag(s,i))return;let y=this.isDragging?"drag":"dragstart";this.isDragging||this.disableClickEvents(),this.isDragging=!0,this.dispatch(y,{target:this.target,clientX:s,clientY:i,screenX:a,screenY:m})},"onMouseMove");this.onMouseUp=o(t=>{if(t.preventDefault(),this.isDragging&&this.target){let{clientX:s,clientY:i,screenX:a,screenY:m}=t;this.dispatch("drop",{target:this.target,clientX:s,clientY:i,screenX:a,screenY:m})}window.requestAnimationFrame(()=>this.resetDragging())},"onMouseUp");this.resetDragging=o(()=>{document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("mousemove",this.onMouseMove),this.isDragging&&this.target&&this.dragEnd(this.target),this.target&&this.restoreClickEvents(),this.isDragging=!1,this.target=void 0},"resetDragging");document.addEventListener("mousedown",this.onMouseDown),window.addEventListener("blur",this.resetDragging)}};o(Le,"MouseDragSensor");var Ne=Le,St=100,U=!1;window.addEventListener("touchmove",r=>{U&&r.preventDefault()},{passive:!1});var Ge=class Ge extends q{constructor(){super();this.onTouchStart=o(t=>{let{target:s}=t;if(!this.isDraggableElement(s))return;let{clientX:i,clientY:a,screenX:m,screenY:y}=t.touches[0];this.setDragStartPosition(i,a),s.setAttribute("draggable","false"),this.target=s,this.tapTimeout=window.setTimeout(()=>{this.startDragging({target:s,clientX:i,clientY:a,screenX:m,screenY:y})},St),window.addEventListener("touchend",this.onTouchEnd),window.addEventListener("touchcancel",this.resetDragging),window.addEventListener("touchmove",this.resetDragging)},"onTouchStart");this.onTouchMove=o(t=>{if(!this.target)return;let{clientX:s,clientY:i,screenX:a,screenY:m}=t.touches[0];this.dispatch("drag",{target:this.target,clientX:s,clientY:i,screenX:a,screenY:m})},"onTouchMove");this.onTouchEnd=o(t=>{if(U&&this.target){let{clientX:i,clientY:a,screenX:m,screenY:y}=t.changedTouches[0];this.dispatch("dragend",{target:this.target,clientX:i,clientY:a,screenX:m,screenY:y})}window.requestAnimationFrame(()=>this.resetDragging())},"onTouchEnd");this.startDragging=o(t=>{this.shouldDispatchDrag(t.clientX,t.clientY)&&(window.removeEventListener("touchmove",this.resetDragging),window.addEventListener("touchmove",this.onTouchMove,{passive:!0}),U=!0,this.disableClickEvents(),this.dispatch("dragstart",t))},"startDragging");this.resetDragging=o(()=>{window.removeEventListener("touchend",this.onTouchEnd),window.removeEventListener("touchcancel",this.resetDragging),window.removeEventListener("touchmove",this.resetDragging),window.removeEventListener("touchmove",this.onTouchMove),U&&this.target&&(this.restoreClickEvents(),this.dragEnd(this.target)),this.target=void 0,U=!1,this.tapTimeout!==void 0&&(clearTimeout(this.tapTimeout),this.tapTimeout=void 0)},"resetDragging");window.addEventListener("touchstart",this.onTouchStart),window.addEventListener("blur",this.resetDragging)}};o(Ge,"TouchDragSensor");var Fe=Ge,Be=class Be{constructor(e){this.touchSensor=new Fe,this.mouseSensor=new Ne,Object.assign(this,e)}addListener(e,t){this.mouseSensor.addListener(e,this.selector,t),this.touchSensor.addListener(e,this.selector,t)}removeListener(e,t){this.mouseSensor.removeListener(e,void 0,t),this.touchSensor.removeListener(e,void 0,t)}reset(){Pt.forEach(e=>{this.mouseSensor.removeListener(e),this.touchSensor.removeListener(e)})}resetDragging(){this.mouseSensor.resetDragging(),this.touchSensor.resetDragging()}};o(Be,"DragSensor");var z=Be;var C,nt=o(()=>{C?.reset(),C=new z({selector:".miro-draggable"})},"initDragSensor");var J="internal:drop",H=new Set,E=new Map,V;async function ot(r){let e=r.payload;if(e==null)return;let{x:t,y:s}=e,i={x:t,y:s,target:V};H.forEach(a=>a(i)),C.resetDragging()}o(ot,"handleInternalDrop");var Dt=o(r=>async e=>{let{clientX:t,clientY:s,target:i}=e.detail;V=i;let a=V.dataset.dragPreview,m=parseInt(V.dataset.dragPreviewWidth??"",10),y=parseInt(V.dataset.dragPreviewHeight??"",10);await r.exec("UI_DRAG_START",{clientX:t,clientY:s,dragImage:a?{width:m===Number.NaN?void 0:m,height:y===Number.NaN?void 0:y,src:a}:void 0})},"onDragStart"),ke,Ot=o(r=>async e=>{if(ke)return;ke=requestAnimationFrame(()=>{ke=void 0});let{clientX:t,clientY:s}=e.detail;await r.exec("UI_DRAG_MOVE",{clientX:t,clientY:s})},"onDrag"),Mt=o(r=>async e=>{let{clientX:t,clientY:s}=e.detail;await r.exec("UI_DRAG_DROP",{clientX:t,clientY:s})},"onDrop"),Rt=o(r=>async e=>{await r.exec("UI_DRAG_END")},"onDragEnd");async function it(r,e){H.size==0&&(await r.exec("UI_REGISTER_EVENT",{name:J}),r.subscribe(J,ot),E.set("dragstart",Dt(r)),E.set("drag",Ot(r)),E.set("dragend",Rt(r)),E.set("drop",Mt(r)),C.addListener("dragstart",E.get("dragstart")),C.addListener("drag",E.get("drag")),C.addListener("dragend",E.get("dragend")),C.addListener("drop",E.get("drop"))),H.add(e)}o(it,"attachDragAndDropListeners");async function at(r,e){H.delete(e),H.size===0&&(C.removeListener("dragstart",E.get("dragstart")),C.removeListener("drag",E.get("drag")),C.removeListener("dragend",E.get("drag")),C.removeListener("drop",E.get("drop")),r.unsubscribe(J,ot),await r.exec("UI_UNREGISTER_EVENT",{name:J}))}o(at,"detachDragAndDropListeners");var Ue=class Ue{constructor(e){p(this,n,e),p(this,c,new h(e))}async openPanel(e){await this[n].exec("UI_OPEN_PANEL",e);let t=this[n].exec("UI_WAIT_FOR_PANEL_CLOSE",e);return{waitForClose:()=>t}}async getPanelData(){return this[n].exec("UI_GET_PANEL_DATA")}async canOpenPanel(){return this[n].exec("UI_CAN_OPEN_PANEL")}async closePanel(e){await this[n].exec("UI_CLOSE_PANEL",{result:e})}async openModal(e){await this[n].exec("UI_OPEN_MODAL",e);let t=this[n].exec("UI_WAIT_FOR_MODAL_CLOSE",e);return{waitForClose:()=>t}}async getModalData(){return this[n].exec("UI_GET_MODAL_DATA")}async closeModal(e){await this[n].exec("UI_CLOSE_MODAL",{result:e})}async canOpenModal(){return this[n].exec("UI_CAN_OPEN_MODAL")}on(e,t){switch(e){case"drop":return it(this[n],t),Promise.resolve();case"icon:click":return this[c].subscribe(e,t,async()=>t());case"app_card:open":return this[c].subscribe(e,t,async s=>{let{appCard:i}=s.payload,a={appCard:T(this[n],i)};t(a)});case"app_card:connect":return this[c].subscribe(e,t,async s=>{let{appCard:i}=s.payload,a={appCard:T(this[n],i)};t(a)});case"selection:update":return this[c].subscribe(e,t,async s=>{let{items:i}=s.payload,a={items:i.map(m=>T(this[n],m))};t(a)});case"online_users:update":return this[c].subscribe(e,t,async s=>{let i=s.payload;t(i)});case"items:create":return this[c].subscribe(e,t,async s=>{let{items:i}=s.payload,a={items:i.map(m=>T(this[n],m))};t(a)});case"experimental:items:update":return this[c].subscribe(e,t,async s=>{let{items:i}=s.payload,a={items:i.map(m=>T(this[n],m))};t(a)});case"items:delete":return this[c].subscribe(e,t,async s=>{let{items:i}=s.payload,a={items:i.map(m=>T(this[n],m))};t(a)});default:if(Re(e)){let s=o(async i=>{let{items:a}=i.payload,m={items:a.map(y=>T(this[n],y))};t(m)},"internalHandler");return this[c].subscribe(e,t,s)}throw new Error(`unknown event: ${e}`)}}off(e,t){switch(e){case"drop":return at(this[n],t),Promise.resolve();case"icon:click":case"app_card:open":case"app_card:connect":case"selection:update":case"online_users:update":case"items:create":case"experimental:items:update":case"items:delete":return this[c].unsubscribe(e,t);default:if(Re(e))return this[c].unsubscribe(e,t);throw new Error(`unknown event: ${e}`)}}};o(Ue,"BoardUI");var K=Ue;var Nt=(r=>(r.Red="red",r.Magenta="magenta",r.Violet="violet",r.LightGreen="light_green",r.Green="green",r.DarkGreen="dark_green",r.Cyan="cyan",r.Blue="blue",r.DarkBlue="dark_blue",r.Yellow="yellow",r.Gray="gray",r.Black="black",r))(Nt||{}),Ft=(r=>(r.Gray="gray",r.LightYellow="light_yellow",r.Yellow="yellow",r.Orange="orange",r.LightGreen="light_green",r.Green="green",r.DarkGreen="dark_green",r.Cyan="cyan",r.LightPink="light_pink",r.Pink="pink",r.Violet="violet",r.Red="red",r.LightBlue="light_blue",r.Blue="blue",r.DarkBlue="dark_blue",r.Black="black",r))(Ft||{}),Lt=(r=>(r.Rectangle="rectangle",r.Circle="circle",r.Triangle="triangle",r.WedgeRoundRectangleCallout="wedge_round_rectangle_callout",r.RoundRectangle="round_rectangle",r.Rhombus="rhombus",r.Parallelogram="parallelogram",r.Star="star",r.RightArrow="right_arrow",r.LeftArrow="left_arrow",r.Pentagon="pentagon",r.Hexagon="hexagon",r.Octagon="octagon",r.Trapezoid="trapezoid",r.FlowChartPredefinedProcess="flow_chart_predefined_process",r.LeftRightArrow="left_right_arrow",r.Cloud="cloud",r.LeftBrace="left_brace",r.RightBrace="right_brace",r.Cross="cross",r.Can="can",r))(Lt||{}),Gt=(r=>(r.Rectangle="rectangle",r.Circle="circle",r.Triangle="triangle",r.WedgeRoundRectangleCallout="wedge_round_rectangle_callout",r.RoundRectangle="round_rectangle",r.Rhombus="rhombus",r.Parallelogram="parallelogram",r.Star="star",r.RightArrow="right_arrow",r.LeftArrow="left_arrow",r.Pentagon="pentagon",r.Hexagon="hexagon",r.Octagon="octagon",r.Trapezoid="trapezoid",r.FlowChartPredefinedProcess="flow_chart_predefined_process",r.LeftRightArrow="left_right_arrow",r.Cloud="cloud",r.LeftBrace="left_brace",r.RightBrace="right_brace",r.Cross="cross",r.Can="can",r.FlowChartConnector="flow_chart_connector",r.FlowChartMagneticDisk="flow_chart_magnetic_disk",r.FlowChartInputOutput="flow_chart_input_output",r.FlowChartDecision="flow_chart_decision",r.FlowChartDelay="flow_chart_delay",r.FlowChartDisplay="flow_chart_display",r.FlowChartDocument="flow_chart_document",r.FlowChartMagneticDrum="flow_chart_magnetic_drum",r.FlowChartInternalStorage="flow_chart_internal_storage",r.FlowChartManualInput="flow_chart_manual_input",r.FlowChartManualOperation="flow_chart_manual_operation",r.FlowChartMerge="flow_chart_merge",r.FlowChartMultidocument="flow_chart_multidocument",r.FlowChartNoteCurlyLeft="flow_chart_note_curly_left",r.FlowChartNoteCurlyRight="flow_chart_note_curly_right",r.FlowChartNoteSquare="flow_chart_note_square",r.FlowChartOffpageConnector="flow_chart_offpage_connector",r.FlowChartOr="flow_chart_or",r.FlowChartPredefinedProcess2="flow_chart_predefined_process_2",r.FlowChartPreparation="flow_chart_preparation",r.FlowChartProcess="flow_chart_process",r.FlowChartOnlineStorage="flow_chart_online_storage",r.FlowChartSummingJunction="flow_chart_summing_junction",r.FlowChartTerminator="flow_chart_terminator",r))(Gt||{}),Z=(r=>(r.Error="error",r.Info="info",r))(Z||{});var Ve=class Ve{constructor(e){p(this,n,e)}async showInfo(e){let t={message:e,type:Z.Info};await this[n].exec("SHOW_NOTIFICATION",t)}async showError(e){let t={message:e,type:Z.Error};await this[n].exec("SHOW_NOTIFICATION",t)}async show(e){await this[n].exec("SHOW_NOTIFICATION",e)}};o(Ve,"Notifications");var Q=Ve;var He=class He{constructor(e){p(this,n,e)}async get(){return this[n].exec("VIEWPORT_GET")}async set(e){return this[n].exec("VIEWPORT_SET",e)}async zoomTo(e){return Array.isArray(e)?this[n].exec("VIEWPORT_ZOOM_TO",{items:e.map(t=>t.id)}):this.zoomTo([e])}async getZoom(){return this[n].exec("VIEWPORT_GET_ZOOM")}async setZoom(e){return this[n].exec("VIEWPORT_SET_ZOOM",{zoomLevel:e})}};o(He,"Viewport");var ee=He;var mt=o(r=>`realtime_event:${r}`,"prefixed"),We=class We{constructor(e){p(this,n,e),p(this,c,new h(e))}async broadcast(e,t){await this[n].exec("SEND_REALTIME_BROADCAST_EVENT",{event:e,payload:t})}on(e,t){let s=o(async a=>{t(a.payload)},"internalHandler"),i=mt(e);return this[c].subscribe(i,t,s)}off(e,t){let s=mt(e);return this[c].unsubscribe(s,t)}};o(We,"RealtimeEvents");var te=We;var pt=o((r,e)=>`storage:change:${r}:${e}`,"prefixed"),$e=class $e{constructor(e,t,s){this.name=e;p(this,n,t),p(this,c,s)}async set(e,t){return this[n].exec("STORAGE_SET",{collection:this.name,key:e,value:t})}async get(e){return(await this[n].exec("STORAGE_GET",{collection:this.name,key:e})).value}async remove(e){return this[n].exec("STORAGE_REMOVE",{collection:this.name,key:e})}async onValue(e,t){let s=await this[n].exec("STORAGE_GET",{collection:this.name,key:e});t(s?.value,s?.version);let i=o(async m=>{let{value:y,version:pe}=m.payload;return t(y,pe)},"internalHandler"),a=pt(this.name,e);return this[c].subscribe(a,t,i)}async offValue(e,t){let s=pt(this.name,e);return this[c].unsubscribe(s,t)}};o($e,"Collection");var Ye=$e,je=class je{constructor(e){p(this,n,e),p(this,c,new h(e))}collection(e){return new Ye(e,this[n],this[c])}};o(je,"Storage");var re=je;var Xe=class Xe{constructor(e){p(this,n,e)}async follow(e,t={}){let s={followee:e,...t};await this[n].exec("ATTENTION_FOLLOW",s)}async isFollowing(){return this[n].exec("ATTENTION_IS_FOLLOWING")}async getFollowedUser(){return this[n].exec("ATTENTION_GET_FOLLOWED_USER")}async unfollow(e){await this[n].exec("ATTENTION_UNFOLLOW",e)}};o(Xe,"Attention");var se=Xe;var qe=class qe{constructor(e,t,s,i,a,m,y){this.id=e;this.name=t;this.description=s;this.color=i;this.starterId=a;this.starterName=m;p(this,n,y),p(this,c,new h(y))}async invite(...e){await this[n].exec("SESSIONS_INVITE_USERS",{sessionId:this.id,userIds:e.flat().map(t=>t.id)})}async join(){await this[n].exec("SESSIONS_JOIN",{sessionId:this.id})}async leave(){await this[n].exec("SESSIONS_LEAVE",{sessionId:this.id})}getUsers(){throw new Error("Method not implemented.")}async hasJoined(e){return this[n].exec("SESSIONS_USER_JOINED",{sessionId:this.id,userId:e})}async on(e,t){if(e!=="user-left"&&e!=="user-joined"&&e!=="invitation-responded")return;let s=o(async a=>{a.payload.sessionId===this.id&&await t(a.payload)},"wrappedHandler"),i=`sessions:${e}`;await this[c].subscribe(i,t,s)}async off(e,t){if(e!=="user-left"&&e!=="user-joined"&&e!=="invitation-responded")return;let s=`sessions:${e}`;await this[c].unsubscribe(s,t)}async end(){await this[n].exec("SESSIONS_END",{id:this.id}),await this[c].unsubscribeAll()}};o(qe,"Session");var W=qe;var ze=class ze{constructor(e){this.attention=new se(e),p(this,n,e),p(this,c,new h(e))}async startSession(e){let t=await this[n].exec("SESSIONS_START",e);return new W(t.id,t.name,t.description,t.color,t.starterId,t.starterName,this[n])}async getSessions(){return(await this[n].exec("SESSIONS_GET")).map(t=>new W(t.id,t.name,t.description,t.color,t.starterId,t.starterName,this[n]))}async on(e,t){if(e!=="sessions:started"&&e!=="sessions:ended")throw new Error(`${e} does not exist`);let s=o(async i=>{await t(i.payload)},"wrappedHandler");return this[c].subscribe(e,t,s)}async off(e,t){if(e!=="sessions:started"&&e!=="sessions:ended")throw new Error(`${e} does not exist`);return this[c].unsubscribe(e,t)}async zoomTo(e,t){return Array.isArray(t)?this[n].exec("COLLABORATION_VIEWPORT_ZOOM_TO",{items:t.map(s=>s.id),user:e}):this.zoomTo(e,[t])}};o(ze,"Collaboration");var ne=ze;var dt=o(r=>`timer:${r}`,"prefixed"),Je=class Je{constructor(e){p(this,n,e),p(this,c,new h(e))}async get(){return this[n].exec("TIMER_GET")}async start(e){let t={duration:e};return this[n].exec("TIMER_START",t)}async stop(){return this[n].exec("TIMER_STOP")}async pause(){return this[n].exec("TIMER_PAUSE")}async resume(){return this[n].exec("TIMER_RESUME")}async prolong(e){let t={duration:e};return this[n].exec("TIMER_PROLONG",t)}async isStarted(){return this[n].exec("TIMER_IS_STARTED")}async on(e,t){let s=o(async a=>{t(a.payload)},"internalHandler"),i=dt(e);return this[c].subscribe(i,t,s)}async off(e,t){let s=dt(e);return this[c].unsubscribe(s,t)}};o(Je,"Timer");var oe=Je;async function w(r,e){let t=rt(r),s=await e.exec("WIDGET_CREATE",t);return d(r,s),r}o(w,"add");var Ke=class Ke{constructor(e,t){p(this,n,e),this.ui=new K(e),this.notifications=new Q(e),this.viewport=new ee(e),this.storage=new re(e),this.experimental=t,this.events=new te(e),this.timer=new oe(e),this.collaboration=new ne(this[n])}async createCard(e){return w(new S(this[n],e),this[n])}async createAppCard(e){return w(new _(this[n],e),this[n])}async createFrame(e){return w(new D(this[n],e),this[n])}async createImage(e){return w(new I(this[n],e),this[n])}async createPreview(e){return w(new O(this[n],e),this[n])}async createShape(e){return w(new P(this[n],e),this[n])}async createStickyNote(e){return w(new x(this[n],e),this[n])}async createText(e){return w(new v(this[n],e),this[n])}async createEmbed(e){return w(new M(this[n],e),this[n])}async createConnector(e){return w(new R(this[n],e),this[n])}async createTag(e){return w(new N(this[n],e),this[n])}async sync(e){return e.sync()}async remove(e){let{id:t,type:s}=e;await this[n].exec("WIDGET_REMOVE",{id:t,type:s})}async bringToFront(e){return Array.isArray(e)?this[n].exec("BRING_TO_FRONT",{items:e.map(t=>t.id)}):this.bringToFront([e])}async sendToBack(e){return Array.isArray(e)?this[n].exec("SEND_TO_BACK",{items:e.map(t=>t.id)}):this.sendToBack([e])}async bringInFrontOf(e,t){return Array.isArray(e)?this[n].exec("BRING_IN_FRONT_OF",{items:e.map(s=>s.id),targetId:t.id}):this.bringInFrontOf([e],t)}async sendBehindOf(e,t){return Array.isArray(e)?this[n].exec("SEND_BEHIND_OF",{items:e.map(s=>s.id),targetId:t.id}):this.sendBehindOf([e],t)}async getLayerIndex(e){return e.getLayerIndex()}async getById(e){let t=await this.get({id:e});if(Array.isArray(t)&&t.length)return this.convertToSdkFormat(this[n],t[0]);throw new Error(`Can not retrieve item with id ${e}`)}async get(e){return f(e,this[n],(t,s)=>this.convertToSdkFormat(t,s))}async getInfo(){return this[n].exec("GET_BOARD_INFO")}async getUserInfo(){return this[n].exec("GET_USER_INFO")}async getSelection(){return(await this[n].exec("GET_SELECTION")).map(t=>this.convertToSdkFormat(this[n],t))}async getOnlineUsers(){return this[n].exec("GET_ONLINE_USERS")}async select(e){return(await this[n].exec("SELECT_WIDGETS",e)).map(s=>this.convertToSdkFormat(this[n],s))}async deselect(e){return(await this[n].exec("DESELECT_WIDGETS",e)).map(s=>this.convertToSdkFormat(this[n],s))}async getAppData(e){return this[n].exec("GET_BOARD_APP_DATA",{key:e})}async setAppData(e,t){return this[n].exec("SET_BOARD_APP_DATA",{key:e,value:t})}async setMetadata(e,t,s){return e.setMetadata(t,s)}async getMetadata(e,t){return e.getMetadata(t)}async goToLink(e){return e.goToLink()}async getIdToken(){return this[n].exec("GET_ID_TOKEN")}async canUse(e){return this[n].exec("CHECK_FEATURE_ENTITLEMENT",{feature:e})}async group(e){let{items:t}=e,s=t.map(a=>a.id),i=await w(new F(this[n],{itemsIds:s,type:"group"}),this[n]);return await Promise.all(t.map(async a=>{let[m]=await f({id:a.id},this[n],g);d(a,m)})),i}convertToSdkFormat(e,t){return T(e,t)}};o(Ke,"Board");var ie=Ke;var Ze=class Ze{constructor(e){p(this,n,e)}async register(e){return this[n].exec("CUSTOM_ACTION_REGISTER",e)}async deregister(e){await this[n].exec("CUSTOM_ACTION_DEREGISTER",e)}};o(Ze,"CustomActionManagement");var ae=Ze;var Qe=class Qe{constructor(e){p(this,n,e),this.action=new ae(e)}async createMindmapNode(e){let t=await this[n].exec("WIDGET_CREATE",new X(e));return new A(this[n],t)}async createShape(e){let t=await this[n].exec("WIDGET_CREATE",new b(this[n],e));return new b(this[n],t)}async get(e){return f(e,this[n],g)}async select(e){return(await this[n].exec("SELECT_WIDGETS",e)).map(s=>g(this[n],s))}async deselect(e){return(await this[n].exec("DESELECT_WIDGETS",e)).map(s=>g(this[n],s))}async getSelection(){return(await this[n].exec("GET_SELECTION")).map(t=>g(this[n],t))}async getVotingResults(){return this[n].exec("GET_VOTING_RESULTS")}async sync(e){return e.sync()}async remove(e){let{id:t,type:s}=e;await this[n].exec("WIDGET_REMOVE",{id:t,type:s})}async findEmptySpace(e){return this[n].exec("FIND_EMPTY_SPACE",e)}};o(Qe,"Experimental");var me=Qe;var ct="1.58459.0",et=new G(window),Bt=new B(et,"experimental"),kt=new me(Bt),Ut=new ie(et,kt);et.exec("handshake",{clientVersion:ct});nt();typeof location<"u"&&new URLSearchParams(location.search).has("autotest")&&console.log("SDKv2 loaded for client version: 1.58459.0 and git commit: 72a633ec4842c8e3494b0058ab36389f80fb06bb");return ft(Vt);})();
